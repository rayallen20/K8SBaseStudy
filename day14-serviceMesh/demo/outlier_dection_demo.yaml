clusters:
- name: ...
  ...
  # 和health_check相同 outlier_detection位于集群配置的顶级配置段
  outlier_detection:
    # 因连续5xx错误而弹出主机之前 
    # 允许出现的连续5xx响应或本地原始错误的数量 默认为5
    # 即:连续出现多少次5XX错误后(若中间出现了非5XX的错误,同样不被认为是"连续出现多少次5XX错误") 
    # 端点被判定为异常
    consecutive_5xx: ... 
    # 弹射分析扫描之间的时间间隔 默认为10000ms或10s
    # 可以认为是每10s执行一次弹出端点的操作 健康状态检测可能是每2s执行1次
    # 但弹出操作每隔多长时间执行1次 是由该字段值定义的
    interval: ... 
    # 主机被弹出的基准时长 主机弹出支持退避算法
    # 主机被弹出的实际时长 = 基准时长 * 主机已经弹出的次数 
    # 默认为30000ms或30s
    # 该字段定义了主机每次被弹出后 处于弹出状态的时长
    # 经过该时长后 主机自动被判定为正常 后续如果该主机依然处于异常状态
    # 则经过异常判定的操作后 再次被弹出
    # 假定该值为30s 那么第1次主机被弹出 弹出状态为30s
    # 第2次该主机被弹出 则弹出状态持续60s 以此类推
    base_ejection_time: ...
    # 因异常探测而允许弹出的上游集群中的主机数量百分比 默认为10%
    # 不过 无论如何 至少要弹出一个主机
    # 即:被弹出的端点可以占到集群中的最大比例
    # 假设集群中不到10个主机
    # 那么每次执行弹出操作时 至少也会弹出1个主机 否则弹出操作就没有意义了
    max_ejection_percent: ... 
    # 基于连续的5xx检测到主机异常时主机将被弹出的几率 
    # 可用于禁止弹出或缓慢弹出 默认为100
    # 默认情况下 一旦失败次数到达consecutive_5xx中定义的次数后 主机必然被弹出
    # 但此处定义了一个几率 使得主机被弹出的速度变慢了
    # 例如:50%则需要2次检测才弹出 100%则1次检测就弹出了 即速率变慢
    enforcing_consecutive_5xx: ... 
    # 基于成功率检测到主机异常时主机将被弹出的几率 
    # 可用于禁止弹出或缓慢弹出 默认为100
    enforcing_success_rate: ... 
    # 对集群启动成功率异常检测的最少主机数 默认值为5
    # 即:默认情况下 集群中的主机数少于5 则不启动成功率异常检测
    success_rate_minimum_hosts: ... 
    # 在检测的一次时间间隔中必须收集的总请求的最小值 默认值为100
    # 即:只有在指定的间隔时间中 接收的请求数到达该值的主机 才会参与成功率异常检测
    success_rate_request_volume: ... 
    # 用确定成功率异常值弹出的弹射阈值的因子 
    # 弹射阈值 = 成功率均值 - ( 因子 * 平均成功率标准差 )
    # 不过 此处设置的值需要除以1000以得到因子
    # 例如 需要使用1.3为因子时 需要将该参数值设定为1300
    # 该值越大 弹射阈值越低 也就是说主机被弹出的错误率就越小
    # 此处的弹射阈值 实际上就是每台主机的错误率阈值 
    # 当主机的错误率高于该阈值时 将被弹出
    success_rate_stdev_factor: ... 
    # 因连续网关故障而弹出主机的最少连续故障数 默认为5
    # 即弹出条件 对于一个HTTP服务而言 网关故障(502 503 504)是最常见的
    # 因此该字段很常用 表示对一个HTTP服务的主机 连续出现多少次网关故障 即弹出该主机
    consecutive_gateway_failure: ... 
    # 基于连续网关故障检测到异常状态时而弹出主机的几率的百分比 默认为0
    # 即:由于连续的网关故障 而导致主机弹出的几率
    enforcing_consecutive_gateway_failure: ... 
    # 是否区分本地原因而导致的故障和外部故障 默认为false
    # 此项设置为true时，以下三项方能生效
    split_external_local_origin_errors: ... 
    # 因本地原因的故障而弹出主机的最少故障次数 默认为5
    consecutive_local_origin_failure: ... 
    # 基于连续的本地故障检测到异常状态而弹出主机的几率百分比 默认为100
    enforcing_consecutive_local_origin_failure: ... 
    # 基于本地故障检测的成功率统计检测到异常状态而弹出主机的几率 默认为100
    enforcing_local_origin_success_rate: ... 
    # 确定基于故障百分比的离群值检测时要使用的故障百分比
    # 如果给定主机的故障百分比大于或等于该值 它将被弹出 默认为85
    failure_percentage_threshold: {...} 
    # 基于故障百分比统计信息检测到异常状态时 实际弹出主机的几率的百分比
    # 此设置可用于禁用弹出或使其缓慢上升 默认为0
    enforcing_failure_percentage: {...} 
    # 基于本地故障百分比统计信息检测到异常状态时 实际主机的概率的百分比 默认为0
    enforcing_failure_percentage_local_origin: {...} 
    # 集群中执行基于故障百分比的弹出的主机的最小数量
    # 若集群中的主机总数小于此值 将不会执行基于故障百分比的弹出 默认为5
    failure_percentage_minimum_hosts: {...} 
    # 必须在一个时间间隔(由上面的时间间隔持续时间定义)中收集总请求的最小数量 
    # 以对此主机执行基于故障百分比的弹出
    # 如果数量低于此设置 则不会对此主机执行基于故障百分比的弹出 默认为50
    failure_percentage_request_volume: {...} 
    # 主机弹出的最长时间 
    # 如果未指定 则使用默认值(300000ms或300s) 
    # 或 base_ejection_time值中的大者
    max_ejection_time: {...} 